<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/spec/system/authentication_on_all_routes_spec.rb">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/spec/system/authentication_on_all_routes_spec.rb" />
              <option name="originalContent" value="require 'rails_helper'&#10;&#10;RSpec.describe &quot;Authentication on all routes&quot;, type: :system do&#10;  # Define patterns for routes to exclude from authentication testing&#10;  EXCLUDED_ROUTE_PATTERNS = [&#10;    %r{^/up$},                    # Health check endpoint&#10;    %r{^/passwords},              # Password reset routes&#10;    %r{^/sign_in$},              # Sign in page&#10;    %r{^/sign_out$},             # Sign out page&#10;    %r{^/sign_up$},              # Sign up page (if exists)&#10;    %r{^/rails/active_storage},   # Active Storage routes&#10;    %r{^/cable$}                  # Action Cable endpoint&#10;  ].freeze&#10;&#10;  def excluded_route?(path)&#10;    EXCLUDED_ROUTE_PATTERNS.any? { |pattern| path.match?(pattern) }&#10;  end&#10;&#10;  @all_app_routes = Rails.application.routes.routes.map do |r|&#10;    route = ActionDispatch::Routing::RouteWrapper.new r&#10;    route&amp;.verb.present? &amp;&amp; !route.internal? ? route : nil&#10;  end.compact!&#10;&#10;  # Filter out excluded routes&#10;  @filtered_routes = @all_app_routes.reject do |route|&#10;    path = route.ast.to_s&#10;    path.gsub!(/:[a-z_]*id/, '1') # replace :id with a dummy id&#10;    path.gsub!(/\(.:format\)/, '') # remove optional format for simplicity&#10;    excluded_route?(path)&#10;  end&#10;&#10;  @filtered_routes.each do |route|&#10;    path = route.ast.to_s&#10;    path.gsub!(/:[a-z_]*id/, '1') # replace :id with a dummy id&#10;    path.gsub!(/\(.:format\)/, '') # remove optional format for simplicity&#10;&#10;    it &quot;should redirect #{route.verb} #{path} to login&quot; do&#10;      send(route.verb.downcase, path)&#10;&#10;      # test it does indeed redirect&#10;      expect(response.status).to eq(302)&#10;      expect(response.location).to include('/sign_in')&#10;&#10;      # you could also continue further testing&#10;      follow_redirect!&#10;      expect(response.body).to include('Password')&#10;    end&#10;  end&#10;end" />
              <option name="updatedContent" value="require 'rails_helper'&#10;&#10;RSpec.describe &quot;Authentication on all routes&quot;, type: :system do&#10;  # Define patterns for routes to exclude from authentication testing&#10;  EXCLUDED_ROUTE_PATTERNS = [&#10;    %r{^/up$},                    # Health check endpoint&#10;    %r{^/passwords},              # Password reset routes&#10;    %r{^/sign_in$},              # Sign in page&#10;    %r{^/sign_out$},             # Sign out page&#10;    %r{^/sign_up$},              # Sign up page (if exists)&#10;    %r{^/rails/active_storage},   # Active Storage routes&#10;    %r{^/cable$}                  # Action Cable endpoint&#10;  ].freeze&#10;&#10;  def excluded_route?(path)&#10;    EXCLUDED_ROUTE_PATTERNS.any? { |pattern| path.match?(pattern) }&#10;  end&#10;&#10;  @all_app_routes = Rails.application.routes.routes.map do |r|&#10;    route = ActionDispatch::Routing::RouteWrapper.new r&#10;    route&amp;.verb.present? &amp;&amp; !route.internal? ? route : nil&#10;  end.compact!&#10;&#10;  # Filter out excluded routes&#10;  @filtered_routes = @all_app_routes.reject do |route|&#10;    path = route.ast.to_s&#10;    path.gsub!(/:[a-z_]*id/, '1') # replace :id with a dummy id&#10;    path.gsub!(/\(.:format\)/, '') # remove optional format for simplicity&#10;    excluded_route?(path)&#10;  end&#10;&#10;  @filtered_routes.each do |route|&#10;    path = route.ast.to_s&#10;    path.gsub!(/:[a-z_]*id/, '1') # replace :id with a dummy id&#10;    path.gsub!(/\(.:format\)/, '') # remove optional format for simplicity&#10;&#10;    it &quot;should redirect #{route.verb} #{path} to login&quot; do&#10;      send(route.verb.downcase, path)&#10;&#10;      # test it does indeed redirect&#10;      expect(response.status).to eq(302)&#10;      expect(response.location).to include('/sign_in')&#10;&#10;      # you could also continue further testing&#10;      follow_redirect!&#10;      expect(response.body).to include('Password')&#10;    end&#10;  end&#10;end" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>